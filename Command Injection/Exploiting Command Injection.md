Muitas vezes, é possível determinar se a injeção de comandos ocorrerá ou não pelos comportamentos de um aplicativo, como você verá na sessão prática desta sala.

Aplicações que utilizam entrada do usuário para preencher comandos do sistema com dados podem, frequentemente, apresentar comportamentos inesperados. Por exemplo, os operadores de shell `ls` ;, `ls` &e &&`ls` combinam dois (ou mais) comandos do sistema e os executam simultaneamente . Caso não esteja familiarizado com esse conceito, vale a pena consultar o módulo de fundamentos do Linux para obter mais informações.

A injeção de comandos pode ser detectada principalmente de duas maneiras:

injeção de comando cega
Injeção de comando detalhado
Defini esses dois métodos na tabela abaixo, e as duas seções subsequentes os explicarão com mais detalhes.

Método	Descrição
Cego	Nesse tipo de injeção, não há saída direta do aplicativo ao testar os payloads. Você precisará investigar o comportamento do aplicativo para determinar se o seu payload foi bem-sucedido ou não.
Verboso	
Nesse tipo de injeção, há feedback direto do aplicativo após o teste de um payload. Por exemplo, ao executar o whoamicomando para verificar sob qual usuário o aplicativo está sendo executado, o aplicativo web exibirá o nome de usuário diretamente na página.



Detecção de Injeção Cega de Comandos

A injeção cega de comandos ocorre quando a injeção de comandos acontece sem que nenhuma saída seja visível, tornando-a imperceptível. Por exemplo, um comando é executado, mas a aplicação web não exibe nenhuma mensagem.

Para esse tipo de injeção de comando , precisaremos usar payloads que causem algum atraso. Por exemplo, os comandos `ping` pinge sleep`ping` são payloads importantes para testes. Usando `ping` pingcomo exemplo, o aplicativo ficará travado por x segundos, dependendo da quantidade de pings especificada.


Outro método para detectar injeção cega de comandos é forçar alguma saída. Isso pode ser feito usando operadores de redirecionamento, como `&& >`. Se você não estiver familiarizado com isso, recomendo consultar o módulo de fundamentos do Linux . Por exemplo, podemos instruir o aplicativo web a executar comandos como `ls` whoamie redirecioná-los para um arquivo. Podemos então usar um comando como `ls` catpara ler o conteúdo desse arquivo recém-criado.

Testar a injeção de comandos dessa forma costuma ser complicado e requer bastante experimentação, principalmente porque a sintaxe dos comandos varia entre Linux e Windows.

O curl comando é uma ótima maneira de testar a injeção de comandos. Isso porque você pode usá-lo curl para enviar e receber dados de um aplicativo em seu payload. Veja o trecho de código abaixo como exemplo: um payload curl simples para um aplicativo pode ser alvo de injeção de comandos .

curl http://vulnerable.app/process.php%3Fsearch%3DThe%20Beatles%3B%20whoami

Detecção de Injeção de Comandos Verbosos

Detectar injeção de comandos dessa forma é provavelmente o método mais fácil dos dois. A injeção de comandos detalhada ocorre quando o aplicativo fornece feedback ou informações sobre o que está acontecendo ou sendo executado.


Por exemplo, o resultado de comandos como ` pingls` ou `ls` whoamié exibido diretamente no aplicativo web.



Cargas úteis


Compilei algumas cargas úteis valiosas para Linux e Windows nas tabelas abaixo.

Linux

Carga útil	Descrição
quem sou eu	Veja sob qual usuário o aplicativo está sendo executado.
ls	Liste o conteúdo do diretório atual. Você poderá encontrar arquivos como arquivos de configuração, arquivos de ambiente (tokens e chaves de aplicativos) e muitos outros itens importantes.
ping	Este comando fará com que a aplicação trave. Isso será útil para testar a injeção cega de comandos em uma aplicação .
dormir	
Esta é outra carga útil para testar uma aplicação quanto à injeção cega de comandos , em situações onde a máquina não possui o software pinginstalado.

nc	O Netcat pode ser usado para abrir um shell reverso no aplicativo vulnerável. Você pode usar esse ponto de acesso para navegar pela máquina alvo em busca de outros serviços, arquivos ou possíveis meios de escalar privilégios.


Windows


Carga útil	Descrição
quem sou eu	Veja sob qual usuário o aplicativo está sendo executado.
dir	Liste o conteúdo do diretório atual. Você poderá encontrar arquivos como arquivos de configuração, arquivos de ambiente (tokens e chaves de aplicativos) e muitos outros itens importantes.
ping	Este comando fará com que a aplicação trave. Isso será útil para testar a injeção cega de comandos em uma aplicação.
tempo esgotado	
Este comando também fará com que a aplicação trave. É útil também para testar a injeção cega de comandos em uma aplicação, caso o pingcomando não esteja instalado.

